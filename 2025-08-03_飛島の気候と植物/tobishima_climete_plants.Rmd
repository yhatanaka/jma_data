---
title: "飛島の気候と植物"
author: "Y. Hatanaka"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```



```{r eval=FALSE, include=FALSE}
install.packages('tidyverse')
```


```{r データ}
source('../jma/jma_class_2.r')

period <- '月'
# period <- '旬'
displ <- '分割'
# displ <- 'リテラル'

csv_file <- paste0('csv/', period, '_', displ, '.csv')
jma_data <- Jma$new(csv_file)
allData <- jma_data$allData()

```
```{r eval=FALSE, include=FALSE}
csv_file_name <-
  str_c(
    'allData_',
  	period,
    '-',
    displ,
    '.csv'
  )

write.csv(allData, file = csv_file_name)
```


```{r 月平均気温}
title = '年間-'
x_axis = 'start_m'
y_axis = '平均気温_平年値'
exp_y = as.name(y_axis)

# testData <- allData %>% dplyr::select(start_m)
# testData %<>% mutate(start_m = start_m %>% as.character %>% as.integer)
# testData
y_axisNumData <- allData %>% dplyr::filter(place %in% c('にかほ','酒田','飛島')) %>% mutate({{ x_axis }} == {{ x_axis }} %>% as.integer) %>% mutate({{ y_axis }} := (!!exp_y) %>% as.numeric) %>% group_by(place)

this_aes <- aes(x=.data[[x_axis]], y=.data[[y_axis]], colour=place, group=place, linetype=place)
g <- ggplot(data = y_axisNumData)
g <- g + theme_set(theme_bw(base_size = 12, base_family='HiraKakuProN-W3'))
# グラフ左上の方(0.1, 0.9)の位置に、凡例の左上(0,1)を
g <- g + theme(axis.text.x = element_text(vjust = 0.5, hjust = 1), legend.position=c(0.05,0.95), legend.justification=c(0,1))
# g <- g + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))


g <- g + geom_line(mapping = this_aes, lwd = 1, na.rm = TRUE)
g <- g + geom_point(mapping = this_aes, size = 3, shape = 16, solid = TRUE)
# g <- g + scale_linetype_manual(values = c('にかほ'='dashed', '札幌'='dotted', '山形'='dotted', '酒田'='dashed', '飛島'='solid'))
g <- g + scale_x_discrete(name = '月', labels = 1:12, limits = 1:12)
g <- g + scale_y_continuous(name = '月平均気温 平年値(℃)')
g <- g + scale_color_hue(name = '')
g <- g + scale_linetype_manual(values = c('にかほ'='dotted', '酒田'='dotted', '飛島'='solid'), name = '')

g
```
```{r PDF保存, eval=FALSE, include=FALSE}
pdf_file_name <-
  str_c(
    title,
  	y_axis,
    '.pdf'
  )
quartz(type = 'pdf', file = pdf_file_name)
plot(g)
dev.off()

```


```{r 冬}
title = '冬季-'
x_axis = 'start_m'
y_axis = '平均気温_平年値'
exp_y = as.name(y_axis)

winterMonth = c(12, 1, 2, 3)
winterMonthChar = c('12', '1', '2', '3')
winterData <- y_axisNumData %>% dplyr::filter(start_m %in% winterMonth)

this_aes <- aes(x=.data[[x_axis]], y=.data[[y_axis]], colour=place, group=place, linetype=place)
g <- ggplot(data = winterData)
g <- g + theme_set(theme_bw(base_size = 12, base_family='HiraKakuProN-W3'))
g <- g + theme(axis.text.x = element_text(vjust = 0.5, hjust = 1), legend.position=c(0.95,0.05), legend.justification=c(1,0))
g <- g + geom_line(mapping = this_aes, lwd = 1, na.rm = TRUE)
g <- g + geom_point(mapping = this_aes, size = 3, shape = 16, solid = TRUE)
g <- g + scale_x_discrete(name = '月', labels = winterMonthChar, limits =  winterMonthChar)
g <- g + scale_y_continuous(name = '月平均気温 平年値(℃)')
g <- g + scale_color_hue(name = '')
g <- g + scale_linetype_manual(values = c('にかほ'='dotted', '酒田'='dotted', '飛島'='solid'), name = '')
g
```

```{r 冬最高気温}
title = '冬季-'
x_axis = 'start_m'
y_axis = '日最高気温_平年値'
exp_y = as.name(y_axis)

winterDataHigh <- winterData %>% mutate({{ y_axis }} := (!!exp_y) %>% as.numeric)

this_aes <- aes(x=.data[[x_axis]], y=.data[[y_axis]], colour=place, group=place, linetype=place)

g <- ggplot(data = winterDataHigh)
g <- g + theme_set(theme_bw(base_size = 12, base_family='HiraKakuProN-W3'))
g <- g + theme(axis.text.x = element_text(vjust = 0.5, hjust = 1), legend.position=c(0.95,0.05), legend.justification=c(1,0))
g <- g + geom_line(mapping = this_aes, lwd = 1, na.rm = TRUE)
g <- g + geom_point(mapping = this_aes, size = 3, shape = 16, solid = TRUE)
g <- g + scale_x_discrete(name = '月', labels = winterMonthChar, limits =  winterMonthChar)
g <- g + scale_y_continuous(name = '日最高気温 平年値(℃)')
g <- g + scale_color_hue(name = '')
g <- g + scale_linetype_manual(values = c('にかほ'='dotted', '酒田'='dotted', '飛島'='solid'), name = '')
g
```

```{r 冬最低気温}
title = '冬季-'
x_axis = 'start_m'
y_axis = '日最低気温_平年値'
exp_y = as.name(y_axis)

winterDataLow <- winterData %>% mutate({{ y_axis }} := (!!exp_y) %>% as.numeric)

this_aes <- aes(x=.data[[x_axis]], y=.data[[y_axis]], colour = place, group = place, linetype = place)

g <- ggplot(data = winterDataLow)
g <- g + theme_set(theme_bw(base_size = 12, base_family = 'HiraKakuProN-W3'))
g <- g + theme(axis.text.x = element_text(vjust = 0.5, hjust = 1), legend.position=c(0.95,0.05), legend.justification=c(1,0))
g <- g + geom_line(mapping = this_aes, lwd = 1, na.rm = TRUE)
g <- g + geom_point(mapping = this_aes, size = 3, shape = 16, solid = TRUE)
g <- g + scale_x_discrete(name = '月', labels = winterMonthChar, limits =  winterMonthChar)
g <- g + scale_y_continuous(name = '日最低気温 平年値(℃)')
g <- g + scale_color_hue(name = '')
g <- g + scale_linetype_manual(values = c('にかほ'='dotted', '酒田'='dotted', '飛島'='solid'), name = '')
g
```
```{r 真冬日}
title = '真冬日-'
x_axis = 'start_m'
y_axis = '日最高気温0℃未満日数_平年値'
exp_y = as.name(y_axis)

winterDatabelow0 <- winterData %>% mutate({{ y_axis }} := (!!exp_y) %>% as.numeric)
winterDatabelow0 %<>% select(!!as.name(x_axis),!!exp_y) %>% summarise(total_below0 = sum(!!exp_y))
winterDatabelow0
this_aes <- aes(x = place, y = total_below0, fill = place)

g <- ggplot(data = winterDatabelow0)
g <- g + theme_set(theme_bw(base_size = 12, base_family = 'HiraKakuProN-W3'))
g <- g + theme(axis.text.x = element_text(vjust = 0.5, hjust = 1), legend.position='none')
g <- g + geom_bar(mapping = this_aes, stat='identity')
g <- g + scale_x_discrete(name = '')
g <- g + scale_y_continuous(name = '日最高気温0℃未満(真冬日)日数 平年値')
g <- g + scale_color_hue(name = '')
# g <- g + scale_linetype_manual(values = c('にかほ'='dotted', '酒田'='dotted', '飛島'='solid'), name = '')
g

```

```{r 平均風速}
title = '年間-'
x_axis = 'start_m'
y_axis = '平均風速_平年値'
exp_y = as.name(y_axis)

windData <- y_axisNumData %>% mutate({{ y_axis }} := (!!exp_y) %>% as.numeric)

this_aes <- aes(x=.data[[x_axis]], y=.data[[y_axis]], colour=place, group=place, linetype=place)
g <- ggplot(data = windData)
g <- g + theme_set(theme_bw(base_size = 12, base_family='HiraKakuProN-W3'))
g <- g + theme(axis.text.x = element_text(vjust = 0.5, hjust = 1), legend.position=c(0.7,1), legend.justification=c(0,1))


g <- g + geom_line(mapping = this_aes, lwd = 1, na.rm = TRUE,)
g <- g + geom_point(mapping = this_aes, size = 3, shape = 16)
g <- g + scale_x_discrete(name = '月', labels = 1:12, limits = 1:12)
g <- g + scale_y_continuous(name = '平均風速 平年値(m/s)')
g <- g + scale_color_hue(name = '')
g <- g + scale_linetype_manual(values = c('にかほ'='dotted', '酒田'='dotted', '飛島'='solid'), name = '')

g
```

```{r 夏最高気温}
title = '夏季-'
x_axis = 'start_m'
y_axis = '日最高気温_平年値'
exp_y = as.name(y_axis)

summerMonth = c(6, 7, 8, 9)
summerMonthChar = c('6', '7', '8', '9')
summerData <- y_axisNumData %>% dplyr::filter(start_m %in% summerMonth)

summerDataHigh <- summerData %>% mutate({{ y_axis }} := (!!exp_y) %>% as.numeric)

this_aes <- aes(x=.data[[x_axis]], y=.data[[y_axis]], colour=place, group=place, linetype=place)

g <- ggplot(data = summerDataHigh)
g <- g + theme_set(theme_bw(base_size = 12, base_family='HiraKakuProN-W3'))
g <- g + theme(axis.text.x = element_text(vjust = 0.5, hjust = 1), legend.position=c(0.95,0.99), legend.justification=c(1,1))
g <- g + geom_line(mapping = this_aes, lwd = 1, na.rm = TRUE)
g <- g + geom_point(mapping = this_aes, size = 3, shape = 16, solid = TRUE)
g <- g + scale_x_discrete(name = '月', labels = summerMonthChar, limits =  summerMonthChar)
g <- g + scale_y_continuous(name = '日最高気温 平年値(℃)')
g <- g + scale_color_hue(name = '')
g <- g + scale_linetype_manual(values = c('にかほ'='dotted', '酒田'='dotted', '飛島'='solid'), name = '')
g

```

