"0","# データ読み込み ファイル名指定"
"0","f <-"
"0","  read.table("
"0","    'data_10.csv',"
"0","    sep = "","","
"0","    skip = 1,"
"0","    header = F,"
"0","    fileEncoding = ""Shift_JIS"","
"0","    stringsAsFactors = F,"
"0","    # 空白を削除する"
"0","    na.strings=c("""", ""NULL"")"
"0","  )"
"0","# # 空行削除"
"0","is_blank <- function(x){"
"0","  is.na(x) | x == """""
"0","}"
"0","# すべてが空欄である行を探す"
"0","unnecessary_row <- apply(f, 1, function(x){"
"0","  all(is_blank(x))"
"0","})"
"0","# 「すべてが空欄である行」以外を残す（＝空行の除去）"
"0","f <- f[!unnecessary_row,]"
"0","# 1:月・日 2:旬・半旬"
"0","if(f[1,1]==""集計開始"" && f[2,1]==""集計終了"" && is_blank(f[1,3]) && is_blank(f[3,2])){"
"0","  dataType = ""旬・半旬"""
"0","} else if(is_blank(f[1,1]) && is_blank(f[1,3])) {"
"0","  if(f[1,2] == ""年月""){"
"0","    dataType = ""月"""
"0","  } else if(f[1,2] == ""年月日""){"
"0","    dataType = ""日"""
"0","  }"
"0","}"
"0","notStartEnd <- function(x){"
"0","  result <- sapply(x, function(x){return(x != ""集計開始"" && x != ""集計終了"" && x != ""年月日"")})"
"0","  return(result)"
"0","}"
"0","# str(f)"
"0","placeWithNull <- unique(as.vector(as.matrix(f[1,])[1,]))"
"0","testPlace <- !is.na(placeWithNull) & notStartEnd(placeWithNull)"
"0","placeList <- placeWithNull[!is.na(placeWithNull) & notStartEnd(placeWithNull)]"
"0","placeList"
"1","[1]"
"1"," ""酒田"""
"1"," ""飛島"""
"1","
"
"0","dfList <- list()"
"0","changeToDate <- function(df){"
"0","  # 「年/月」を，その月の1日の日付型に。"
"0","  df <- as.Date(paste(as.character(df), ""/1"", sep = """"))"
"0","  return(as.data.frame(df))"
"0","}"
"0","# 1行目_2行目"
"0","removeCharFromTitle1 <- function(string) {"
"0","  return(gsub(""(\\(.+\\))|(の.+)"", """", string))"
"0","}"
"0","attachTitle <- function(string) {"
"0","  replacedTitleVec <- c(""qlty"", ""unfm"", ""exst"")"
"0","  names(replacedTitleVec) <- c(""品質情報"", ""均質番号"", ""現象なし情報"")"
"0","  return(replacedTitleVec[string])"
"0","}"
"0","makeColumnName <- function(dfCol) {"
"0","  if (is.na(dfCol[3])) {"
"0","    retCol = ""data"""
"0","  } else {"
"0","    retCol = attachTitle(dfCol[3])"
"0","  }"
"0","  return(retCol)"
"0","}"
"0","# タイトルに設定"
"0","setCombinedColumn <- function(df){"
"0","  colnames(df) <- apply(df, 2, makeColumnName)"
"0","  return(df)"
"0","}"
"0","# year,month 付け加える"
"0","ymLabel <- function(x, formatString) {"
"0","  return(format(x, formatString))"
"0","}"
"0","for(i in placeList){"
"0","  # 先頭列は日付"
"0","  yearMonthDf <- f[,1]"
"0","  yearMonthDf <- changeToDate(yearMonthDf[c(-1:-3)])"
"0","  colnames(yearMonthDf) <- ""date"""
"0","  yearMonthDf$year <- as.factor(ymLabel(yearMonthDf$date, ""%Y""))"
"0","  yearMonthDf$month <- as.factor(ymLabel(yearMonthDf$date, ""%m""))"
"0","  # 旬・半旬別の場合は"
"0","  placeDf <- f[,which(f[1,] == i)]"
"0","  itemWithNull <- unique(as.vector(as.matrix(f[2,])[1,]))"
"0","  placeDfList <- list()"
"0","  for(j in itemWithNull){"
"0","    thisItemDf <- placeDf[,which(placeDf[2,] == j)]"
"0","    colnames(thisItemDf) <- apply(thisItemDf, 2, makeColumnName)"
"0","    thisItemDf <- thisItemDf[c(-1:-3),]"
"0","    placeDfList[[removeCharFromTitle1(j)]] <- cbind(yearMonthDf,thisItemDf)"
"0","  }"
"0","  dfList[[i]] <- placeDfList"
"0","}"
"0","typeChange <- function(x){"
"0","  # data はnumeric"
"0","  replaceColumnToNumeric <- c(""data"")"
"0","  # 以下は factor"
"0","  replaceColumnToFactor <- c(""qlty"", ""unfm"", ""exst"")"
"0","  columnNames <- names(x)"
"0","  # 列名の中で，これに含まれる列はこれこれにする"
"0","  for (i in replaceColumnToNumeric) {"
"0","    if (any(columnNames == i)) {"
"0","      x[,i] <- as.numeric(x[,i])"
"0","    }"
"0","  }"
"0","  for (i in replaceColumnToFactor) {"
"0","    if (any(columnNames == i)) {"
"0","      x[,i] <- as.factor(x[,i])"
"0","    }"
"0","  }"
"0","  return(x)"
"0","}"
"0","hierarchyFunc <- function(x){"
"0","  y <- lapply(x,typeChange)"
"0","  return(y)"
"0","}"
"0","dfList <- lapply(dfList, hierarchyFunc)"
