---
title: "tidyverse で処理"
output: 
  html_notebook: 
    fig_height: 7
    fig_width: 7
    smart: no
    toc: yes
---

```{r eval=FALSE, include=FALSE}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.


(初回だけ)パッケージのインストール
```{r eval=FALSE, include=FALSE}
#パッケージのインストール
install.packages("tidyverse")

```

パッケージの読み込み
```{r}
#パッケージの読み込み
library("tidyverse")

```

データ読み込み ファイル名指定
```{r}
# データ読み込み ファイル名指定
f <-
  read_csv(
    'data-sakata-ymd-10-88-18.csv',
    col_names = FALSE,
    skip = 1,
    locale = locale(encoding = "cp932")
  )
f %>% head(6L)
```

空行削除。
```{r}
f %>% head(6L) %>% filter(rowSums(is.na(.)) != ncol(.))
```

```{r}
f %>% head(6L) %>% filter(rowSums(is.na(.)) != ncol(.)) %>% slice(1)
```

unique。
```{r}
f %>% head(6L) %>% filter(rowSums(is.na(.)) != ncol(.)) %>% slice(1) %>% as.matrix() %>% as.vector() %>% unique()
```

data_tbl ってデータ作っといて，1行目から"集計開始"・"集計終了"・NA除いたもの（＝地名）のベクトル 作る。
```{r}
data_tbl <- f %>% filter(rowSums(is.na(.)) != ncol(.))
primary_row <- data_tbl %>% slice(1) %>% as.matrix() %>% as.vector()
placeList <- primary_row %>% unique() %>% setdiff(c("集計開始", "集計終了")) %>% na.omit()
placeList[1]
```

placeList ん中の地名を，place という列としてくっつける。
```{r}
newData_tbl <- data_tbl %>% mutate(place = placeList[1]) %>% select(place, everything())
newData_tbl
newData2_tbl <- data_tbl %>% mutate(place = placeList[1]) %>% select(c(1:6), place, which(grepl("酒田", primary_row)))
newData2_tbl
```

日付の列（X1〜X6）と，データの列（X7 以降，1行目が"酒田"）とを分ける。
```{r}
data_tbl %>% select(c(1:6))

# date_tbl <- 
```

```{r}
grepl("酒田", primary_row)
which(grepl(placeList[1], primary_row))
```

```{r}
data_tbl %>% select(which(grepl(placeList[1], primary_row)))
```

```{r}

```

