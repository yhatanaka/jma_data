<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Y.Hatanaka" />


<title>データフレームを項目ごとに分割</title>

<script src="jma_split_item_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="jma_split_item_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="jma_split_item_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="jma_split_item_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="jma_split_item_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="jma_split_item_files/navigation-1.1/tabsets.js"></script>
<link href="jma_split_item_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="jma_split_item_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">データフレームを項目ごとに分割</h1>
<h4 class="author"><em>Y.Hatanaka</em></h4>
<h4 class="date"><em>2018/11/9</em></h4>

</div>


<p>今までは，地点ごとに1つのデータフレーム だった。</p>
<p>これを，項目ごとに分けてみる。</p>
<p>とりあえず読み込んで</p>
<pre class="r"><code># データ読み込み ファイル名指定
f &lt;-
  read.table(
    &#39;data.csv&#39;,
    sep = &quot;,&quot;,
    skip = 1,
    header = F,
    fileEncoding = &quot;Shift_JIS&quot;,
    stringsAsFactors = F,
# 空白を削除する
    na.strings=c(&quot;&quot;, &quot;NULL&quot;)
)

# # 空行削除
is_blank &lt;- function(x){
  is.na(x) | x == &quot;&quot;
}
# すべてが空欄である行を探す
unnecessary_row &lt;- apply(f, 1, function(x){
  all(is_blank(x))
})
# 「すべてが空欄である行」以外を残す（＝空行の除去）
f &lt;- f[!unnecessary_row,]


# str(f)
#各地点の地名
placeWithNull &lt;- unique(as.vector(as.matrix(f[1,])[1,]))
placeList &lt;- placeWithNull[!is.na(placeWithNull)]</code></pre>
<pre><code>V1: [NA], [&quot;年月&quot;], [NA], [年月], [年月], [年月]…
V2: [地名], [項目名+], [NA / 品質・均質 etc.], </code></pre>
<p>これを，</p>
<pre><code>地点 =&gt; {
  項目名 =&gt; 
    date: 年月, 年月,…
    data: データ, データ,…
    qlty: データ, データ,…
    unfm: データ, データ,…
    exst: データ, データ,…
  }
  項目名 =&gt; 
    date: 年月, 年月,…
    data: データ, データ,…
    qlty: データ, データ,…
    unfm: データ, データ,…
    exst: データ, データ,…
  }
}</code></pre>
<p>とまとめたい。</p>
<pre class="r"><code>dfList &lt;- list()
for(i in placeList){
  # 先頭列は日付
  yearMonthDf &lt;- f[,1]
  placeDf &lt;- f[,which(f[1,] == i)]
  itemWithNull &lt;- unique(as.vector(as.matrix(f[2,])[1,]))
  placeDfList &lt;- list()
  for(j in itemWithNull){
    thisItemDf &lt;- placeDf[,which(placeDf[2,] == j)]
    placeDfList[[j]] &lt;- thisItemDf
  }
  dfList[[i]] &lt;- placeDfList
}
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月                :&#39;data.frame&#39;:   506 obs. of  0 variables
##   ..$ 平均気温(℃)        :&#39;data.frame&#39;:  506 obs. of  3 variables:
##   .. ..$ V2: chr [1:506] &quot;酒田&quot; &quot;平均気温(℃)&quot; NA &quot;-1.3&quot; ...
##   .. ..$ V3: chr [1:506] &quot;酒田&quot; &quot;平均気温(℃)&quot; &quot;品質情報&quot; &quot;8&quot; ...
##   .. ..$ V4: chr [1:506] &quot;酒田&quot; &quot;平均気温(℃)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日最高気温の平均(℃):&#39;data.frame&#39;:  506 obs. of  3 variables:
##   .. ..$ V5: chr [1:506] &quot;酒田&quot; &quot;日最高気温の平均(℃)&quot; NA &quot;1.0&quot; ...
##   .. ..$ V6: chr [1:506] &quot;酒田&quot; &quot;日最高気温の平均(℃)&quot; &quot;品質情報&quot; &quot;8&quot; ...
##   .. ..$ V7: chr [1:506] &quot;酒田&quot; &quot;日最高気温の平均(℃)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日最低気温の平均(℃):&#39;data.frame&#39;:  506 obs. of  3 variables:
##   .. ..$ V8 : chr [1:506] &quot;酒田&quot; &quot;日最低気温の平均(℃)&quot; NA &quot;-4.4&quot; ...
##   .. ..$ V9 : chr [1:506] &quot;酒田&quot; &quot;日最低気温の平均(℃)&quot; &quot;品質情報&quot; &quot;8&quot; ...
##   .. ..$ V10: chr [1:506] &quot;酒田&quot; &quot;日最低気温の平均(℃)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 降水量の合計(mm)    :&#39;data.frame&#39;:   506 obs. of  4 variables:
##   .. ..$ V11: chr [1:506] &quot;酒田&quot; &quot;降水量の合計(mm)&quot; NA &quot;101.0&quot; ...
##   .. ..$ V12: chr [1:506] &quot;酒田&quot; &quot;降水量の合計(mm)&quot; &quot;現象なし情報&quot; &quot;0&quot; ...
##   .. ..$ V13: chr [1:506] &quot;酒田&quot; &quot;降水量の合計(mm)&quot; &quot;品質情報&quot; &quot;8&quot; ...
##   .. ..$ V14: chr [1:506] &quot;酒田&quot; &quot;降水量の合計(mm)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日降水量の最大(mm)  :&#39;data.frame&#39;:    506 obs. of  4 variables:
##   .. ..$ V15: chr [1:506] &quot;酒田&quot; &quot;日降水量の最大(mm)&quot; NA &quot;17.5&quot; ...
##   .. ..$ V16: chr [1:506] &quot;酒田&quot; &quot;日降水量の最大(mm)&quot; &quot;現象なし情報&quot; &quot;0&quot; ...
##   .. ..$ V17: chr [1:506] &quot;酒田&quot; &quot;日降水量の最大(mm)&quot; &quot;品質情報&quot; &quot;8&quot; ...
##   .. ..$ V18: chr [1:506] &quot;酒田&quot; &quot;日降水量の最大(mm)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日照時間(時間)      :&#39;data.frame&#39;:   506 obs. of  4 variables:
##   .. ..$ V19: chr [1:506] &quot;酒田&quot; &quot;日照時間(時間)&quot; NA &quot;68.9&quot; ...
##   .. ..$ V20: chr [1:506] &quot;酒田&quot; &quot;日照時間(時間)&quot; &quot;現象なし情報&quot; &quot;0&quot; ...
##   .. ..$ V21: chr [1:506] &quot;酒田&quot; &quot;日照時間(時間)&quot; &quot;品質情報&quot; &quot;8&quot; ...
##   .. ..$ V22: chr [1:506] &quot;酒田&quot; &quot;日照時間(時間)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 最深積雪(cm)        :&#39;data.frame&#39;: 506 obs. of  4 variables:
##   .. ..$ V23: chr [1:506] &quot;酒田&quot; &quot;最深積雪(cm)&quot; NA &quot;31&quot; ...
##   .. ..$ V24: chr [1:506] &quot;酒田&quot; &quot;最深積雪(cm)&quot; &quot;現象なし情報&quot; &quot;0&quot; ...
##   .. ..$ V25: chr [1:506] &quot;酒田&quot; &quot;最深積雪(cm)&quot; &quot;品質情報&quot; &quot;8&quot; ...
##   .. ..$ V26: chr [1:506] &quot;酒田&quot; &quot;最深積雪(cm)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##  $ 飛島:List of 8
##   ..$ 年月                :&#39;data.frame&#39;:   506 obs. of  0 variables
##   ..$ 平均気温(℃)        :&#39;data.frame&#39;:  506 obs. of  3 variables:
##   .. ..$ V27: chr [1:506] &quot;飛島&quot; &quot;平均気温(℃)&quot; NA NA ...
##   .. ..$ V28: chr [1:506] &quot;飛島&quot; &quot;平均気温(℃)&quot; &quot;品質情報&quot; &quot;0&quot; ...
##   .. ..$ V29: chr [1:506] &quot;飛島&quot; &quot;平均気温(℃)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日最高気温の平均(℃):&#39;data.frame&#39;:  506 obs. of  3 variables:
##   .. ..$ V30: chr [1:506] &quot;飛島&quot; &quot;日最高気温の平均(℃)&quot; NA NA ...
##   .. ..$ V31: chr [1:506] &quot;飛島&quot; &quot;日最高気温の平均(℃)&quot; &quot;品質情報&quot; &quot;0&quot; ...
##   .. ..$ V32: chr [1:506] &quot;飛島&quot; &quot;日最高気温の平均(℃)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日最低気温の平均(℃):&#39;data.frame&#39;:  506 obs. of  3 variables:
##   .. ..$ V33: chr [1:506] &quot;飛島&quot; &quot;日最低気温の平均(℃)&quot; NA NA ...
##   .. ..$ V34: chr [1:506] &quot;飛島&quot; &quot;日最低気温の平均(℃)&quot; &quot;品質情報&quot; &quot;0&quot; ...
##   .. ..$ V35: chr [1:506] &quot;飛島&quot; &quot;日最低気温の平均(℃)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 降水量の合計(mm)    :&#39;data.frame&#39;:   506 obs. of  3 variables:
##   .. ..$ V36: chr [1:506] &quot;飛島&quot; &quot;降水量の合計(mm)&quot; NA NA ...
##   .. ..$ V37: chr [1:506] &quot;飛島&quot; &quot;降水量の合計(mm)&quot; &quot;品質情報&quot; &quot;0&quot; ...
##   .. ..$ V38: chr [1:506] &quot;飛島&quot; &quot;降水量の合計(mm)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日降水量の最大(mm)  :&#39;data.frame&#39;:    506 obs. of  3 variables:
##   .. ..$ V39: chr [1:506] &quot;飛島&quot; &quot;日降水量の最大(mm)&quot; NA NA ...
##   .. ..$ V40: chr [1:506] &quot;飛島&quot; &quot;日降水量の最大(mm)&quot; &quot;品質情報&quot; &quot;0&quot; ...
##   .. ..$ V41: chr [1:506] &quot;飛島&quot; &quot;日降水量の最大(mm)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 日照時間(時間)      :&#39;data.frame&#39;:   506 obs. of  3 variables:
##   .. ..$ V42: chr [1:506] &quot;飛島&quot; &quot;日照時間(時間)&quot; NA NA ...
##   .. ..$ V43: chr [1:506] &quot;飛島&quot; &quot;日照時間(時間)&quot; &quot;品質情報&quot; &quot;0&quot; ...
##   .. ..$ V44: chr [1:506] &quot;飛島&quot; &quot;日照時間(時間)&quot; &quot;均質番号&quot; &quot;1&quot; ...
##   ..$ 最深積雪(cm)        :&#39;data.frame&#39;: 506 obs. of  3 variables:
##   .. ..$ V45: chr [1:506] &quot;飛島&quot; &quot;最深積雪(cm)&quot; NA NA ...
##   .. ..$ V46: chr [1:506] &quot;飛島&quot; &quot;最深積雪(cm)&quot; &quot;品質情報&quot; &quot;0&quot; ...
##   .. ..$ V47: chr [1:506] &quot;飛島&quot; &quot;最深積雪(cm)&quot; &quot;均質番号&quot; &quot;1&quot; ...</code></pre>
<p>まとめるときに整形する。</p>
<p>まず1~3行目抜く。</p>
<pre class="r"><code>dfList &lt;- list()
for(i in placeList){
  # 先頭列は日付
  yearMonthDf &lt;- f[,1]
  yearMonthDf &lt;- yearMonthDf[c(-1:-3)]
  placeDf &lt;- f[,which(f[1,] == i)]
  itemWithNull &lt;- unique(as.vector(as.matrix(f[2,])[1,]))
  placeDfList &lt;- list()
  for(j in itemWithNull){
    thisItemDf &lt;- placeDf[,which(placeDf[2,] == j)]
    thisItemDf &lt;- thisItemDf[c(-1:-3),]
    placeDfList[[j]] &lt;- thisItemDf
  }
  dfList[[i]] &lt;- placeDfList
}
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月                :&#39;data.frame&#39;:   503 obs. of  0 variables
##   ..$ 平均気温(℃)        :&#39;data.frame&#39;:  503 obs. of  3 variables:
##   .. ..$ V2: chr [1:503] &quot;-1.3&quot; &quot;0.2&quot; &quot;4.3&quot; &quot;9.0&quot; ...
##   .. ..$ V3: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V4: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  3 variables:
##   .. ..$ V5: chr [1:503] &quot;1.0&quot; &quot;3.1&quot; &quot;8.4&quot; &quot;13.1&quot; ...
##   .. ..$ V6: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V7: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  3 variables:
##   .. ..$ V8 : chr [1:503] &quot;-4.4&quot; &quot;-3.4&quot; &quot;0.0&quot; &quot;4.5&quot; ...
##   .. ..$ V9 : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V10: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量の合計(mm)    :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ V11: chr [1:503] &quot;101.0&quot; &quot;138.0&quot; &quot;97.0&quot; &quot;154.0&quot; ...
##   .. ..$ V12: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V13: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V14: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量の最大(mm)  :&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ V15: chr [1:503] &quot;17.5&quot; &quot;18.5&quot; &quot;18.0&quot; &quot;42.5&quot; ...
##   .. ..$ V16: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V17: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V18: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間(時間)      :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ V19: chr [1:503] &quot;68.9&quot; &quot;76.0&quot; &quot;160.7&quot; &quot;165.7&quot; ...
##   .. ..$ V20: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V21: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V22: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪(cm)        :&#39;data.frame&#39;: 503 obs. of  4 variables:
##   .. ..$ V23: chr [1:503] &quot;31&quot; &quot;52&quot; &quot;8&quot; &quot;0&quot; ...
##   .. ..$ V24: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V25: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V26: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ 飛島:List of 8
##   ..$ 年月                :&#39;data.frame&#39;:   503 obs. of  0 variables
##   ..$ 平均気温(℃)        :&#39;data.frame&#39;:  503 obs. of  3 variables:
##   .. ..$ V27: chr [1:503] NA NA NA NA ...
##   .. ..$ V28: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V29: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  3 variables:
##   .. ..$ V30: chr [1:503] NA NA NA NA ...
##   .. ..$ V31: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V32: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  3 variables:
##   .. ..$ V33: chr [1:503] NA NA NA NA ...
##   .. ..$ V34: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V35: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量の合計(mm)    :&#39;data.frame&#39;:   503 obs. of  3 variables:
##   .. ..$ V36: chr [1:503] NA NA NA NA ...
##   .. ..$ V37: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V38: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量の最大(mm)  :&#39;data.frame&#39;:    503 obs. of  3 variables:
##   .. ..$ V39: chr [1:503] NA NA NA NA ...
##   .. ..$ V40: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V41: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間(時間)      :&#39;data.frame&#39;:   503 obs. of  3 variables:
##   .. ..$ V42: chr [1:503] NA NA NA NA ...
##   .. ..$ V43: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V44: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪(cm)        :&#39;data.frame&#39;: 503 obs. of  3 variables:
##   .. ..$ V45: chr [1:503] NA NA NA NA ...
##   .. ..$ V46: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V47: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...</code></pre>
<p>どうせだから年月はDate型にして，各項目につけとく。</p>
<pre class="r"><code>dfList &lt;- list()
changeToDate &lt;- function(df){
  # 「年/月」を，その月の1日の日付型に。
  df &lt;- as.Date(paste(as.character(df), &quot;/1&quot;, sep = &quot;&quot;))
  return(as.data.frame(df))
}
for(i in placeList){
  # 先頭列は日付
  yearMonthDf &lt;- f[,1]
  yearMonthDf &lt;- changeToDate(yearMonthDf[c(-1:-3)])
  placeDf &lt;- f[,which(f[1,] == i)]
  itemWithNull &lt;- unique(as.vector(as.matrix(f[2,])[1,]))
  placeDfList &lt;- list()
  for(j in itemWithNull){
    thisItemDf &lt;- placeDf[,which(placeDf[2,] == j)]
    thisItemDf &lt;- thisItemDf[c(-1:-3),]
    placeDfList[[j]] &lt;- cbind(yearMonthDf,thisItemDf)
  }
  dfList[[i]] &lt;- placeDfList
}
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月                :&#39;data.frame&#39;:   503 obs. of  1 variable:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温(℃)        :&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V2: chr [1:503] &quot;-1.3&quot; &quot;0.2&quot; &quot;4.3&quot; &quot;9.0&quot; ...
##   .. ..$ V3: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V4: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V5: chr [1:503] &quot;1.0&quot; &quot;3.1&quot; &quot;8.4&quot; &quot;13.1&quot; ...
##   .. ..$ V6: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V7: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V8 : chr [1:503] &quot;-4.4&quot; &quot;-3.4&quot; &quot;0.0&quot; &quot;4.5&quot; ...
##   .. ..$ V9 : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V10: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量の合計(mm)    :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V11: chr [1:503] &quot;101.0&quot; &quot;138.0&quot; &quot;97.0&quot; &quot;154.0&quot; ...
##   .. ..$ V12: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V13: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V14: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量の最大(mm)  :&#39;data.frame&#39;:    503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V15: chr [1:503] &quot;17.5&quot; &quot;18.5&quot; &quot;18.0&quot; &quot;42.5&quot; ...
##   .. ..$ V16: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V17: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V18: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間(時間)      :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V19: chr [1:503] &quot;68.9&quot; &quot;76.0&quot; &quot;160.7&quot; &quot;165.7&quot; ...
##   .. ..$ V20: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V21: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V22: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪(cm)        :&#39;data.frame&#39;: 503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V23: chr [1:503] &quot;31&quot; &quot;52&quot; &quot;8&quot; &quot;0&quot; ...
##   .. ..$ V24: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V25: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V26: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ 飛島:List of 8
##   ..$ 年月                :&#39;data.frame&#39;:   503 obs. of  1 variable:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温(℃)        :&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V27: chr [1:503] NA NA NA NA ...
##   .. ..$ V28: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V29: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V30: chr [1:503] NA NA NA NA ...
##   .. ..$ V31: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V32: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温の平均(℃):&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V33: chr [1:503] NA NA NA NA ...
##   .. ..$ V34: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V35: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量の合計(mm)    :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V36: chr [1:503] NA NA NA NA ...
##   .. ..$ V37: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V38: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量の最大(mm)  :&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V39: chr [1:503] NA NA NA NA ...
##   .. ..$ V40: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V41: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間(時間)      :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V42: chr [1:503] NA NA NA NA ...
##   .. ..$ V43: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V44: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪(cm)        :&#39;data.frame&#39;: 503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V45: chr [1:503] NA NA NA NA ...
##   .. ..$ V46: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V47: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...</code></pre>
<p>ちょっと待て。項目名から余計な部分とる。</p>
<pre class="r"><code>dfList &lt;- list()
changeToDate &lt;- function(df){
  # 「年/月」を，その月の1日の日付型に。
  df &lt;- as.Date(paste(as.character(df), &quot;/1&quot;, sep = &quot;&quot;))
  return(as.data.frame(df))
}
# 1行目_2行目
removeCharFromTitle1 &lt;- function(string) {
  return(gsub(&quot;(\\(.+\\))|(の.+)&quot;, &quot;&quot;, string))
}
removeCharFromTitle2 &lt;- function(string) {
  return(gsub(&quot;(情報)|(番号)&quot;, &quot;&quot;, string))
}
makeColumnName &lt;- function(dfCol) {
  if (is.na(dfCol[3])) {
    retCol = data
  } else {
    retCol = removeCharFromTitle2(dfCol[2])
  }
  return(retCol)
}
# タイトルに設定
setCombinedColumn &lt;- function(df){
  colnames(df) &lt;- apply(df, 2, makeColumnName)
  return(df)
}

for(i in placeList){
  # 先頭列は日付
  yearMonthDf &lt;- f[,1]
  yearMonthDf &lt;- changeToDate(yearMonthDf[c(-1:-3)])
  placeDf &lt;- f[,which(f[1,] == i)]
  itemWithNull &lt;- unique(as.vector(as.matrix(f[2,])[1,]))
  placeDfList &lt;- list()
  for(j in itemWithNull){
    thisItemDf &lt;- placeDf[,which(placeDf[2,] == j)]
    thisItemDf &lt;- thisItemDf[c(-1:-3),]
    placeDfList[[removeCharFromTitle1(j)]] &lt;- cbind(yearMonthDf,thisItemDf)
  }
  dfList[[i]] &lt;- placeDfList
}
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  1 variable:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V2: chr [1:503] &quot;-1.3&quot; &quot;0.2&quot; &quot;4.3&quot; &quot;9.0&quot; ...
##   .. ..$ V3: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V4: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V5: chr [1:503] &quot;1.0&quot; &quot;3.1&quot; &quot;8.4&quot; &quot;13.1&quot; ...
##   .. ..$ V6: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V7: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V8 : chr [1:503] &quot;-4.4&quot; &quot;-3.4&quot; &quot;0.0&quot; &quot;4.5&quot; ...
##   .. ..$ V9 : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V10: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V11: chr [1:503] &quot;101.0&quot; &quot;138.0&quot; &quot;97.0&quot; &quot;154.0&quot; ...
##   .. ..$ V12: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V13: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V14: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V15: chr [1:503] &quot;17.5&quot; &quot;18.5&quot; &quot;18.0&quot; &quot;42.5&quot; ...
##   .. ..$ V16: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V17: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V18: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V19: chr [1:503] &quot;68.9&quot; &quot;76.0&quot; &quot;160.7&quot; &quot;165.7&quot; ...
##   .. ..$ V20: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V21: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V22: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V23: chr [1:503] &quot;31&quot; &quot;52&quot; &quot;8&quot; &quot;0&quot; ...
##   .. ..$ V24: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V25: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ V26: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ 飛島:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  1 variable:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V27: chr [1:503] NA NA NA NA ...
##   .. ..$ V28: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V29: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V30: chr [1:503] NA NA NA NA ...
##   .. ..$ V31: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V32: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V33: chr [1:503] NA NA NA NA ...
##   .. ..$ V34: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V35: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V36: chr [1:503] NA NA NA NA ...
##   .. ..$ V37: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V38: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V39: chr [1:503] NA NA NA NA ...
##   .. ..$ V40: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V41: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V42: chr [1:503] NA NA NA NA ...
##   .. ..$ V43: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V44: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ V45: chr [1:503] NA NA NA NA ...
##   .. ..$ V46: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ V47: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...</code></pre>
<p>3行目削除する前に，各項目の列名も設定。</p>
<pre class="r"><code>removeCharFromTitle1 &lt;- function(string) {
  return(gsub(&quot;(\\(.+\\))|(の.+)&quot;, &quot;&quot;, string))
}
attachTitle &lt;- function(string) {
  replacedTitleVec &lt;- c(&quot;qlty&quot;, &quot;unfm&quot;, &quot;exst&quot;)
  names(replacedTitleVec) &lt;- c(&quot;品質情報&quot;, &quot;均質番号&quot;, &quot;現象なし情報&quot;)
  return(replacedTitleVec[string])
}
makeColumnName &lt;- function(dfCol) {
  if (is.na(dfCol[3])) {
    retCol = &quot;data&quot;
  } else {
    retCol = attachTitle(dfCol[3])
  }
  return(retCol)
}
# タイトルに設定
setCombinedColumn &lt;- function(df){
  colnames(df) &lt;- apply(df, 2, makeColumnName)
  return(df)
}

for(i in placeList){
  # 先頭列は日付
  yearMonthDf &lt;- f[,1]
  yearMonthDf &lt;- changeToDate(yearMonthDf[c(-1:-3)])
  placeDf &lt;- f[,which(f[1,] == i)]
  itemWithNull &lt;- unique(as.vector(as.matrix(f[2,])[1,]))
  placeDfList &lt;- list()
  for(j in itemWithNull){
    thisItemDf &lt;- placeDf[,which(placeDf[2,] == j)]
    colnames(thisItemDf) &lt;- apply(thisItemDf, 2, makeColumnName)
    thisItemDf &lt;- thisItemDf[c(-1:-3),]
    placeDfList[[removeCharFromTitle1(j)]] &lt;- cbind(yearMonthDf,thisItemDf)
  }
  dfList[[i]] &lt;- placeDfList
}
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  1 variable:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;-1.3&quot; &quot;0.2&quot; &quot;4.3&quot; &quot;9.0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;1.0&quot; &quot;3.1&quot; &quot;8.4&quot; &quot;13.1&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;-4.4&quot; &quot;-3.4&quot; &quot;0.0&quot; &quot;4.5&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  5 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;101.0&quot; &quot;138.0&quot; &quot;97.0&quot; &quot;154.0&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;17.5&quot; &quot;18.5&quot; &quot;18.0&quot; &quot;42.5&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;68.9&quot; &quot;76.0&quot; &quot;160.7&quot; &quot;165.7&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;31&quot; &quot;52&quot; &quot;8&quot; &quot;0&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ 飛島:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  1 variable:
##   .. ..$ df: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ df  : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...</code></pre>
<p>日付のとこも列名 “date” にしよう。</p>
<pre class="r"><code>for(i in placeList){
  # 先頭列は日付
  yearMonthDf &lt;- f[,1]
  yearMonthDf &lt;- changeToDate(yearMonthDf[c(-1:-3)])
  colnames(yearMonthDf) &lt;- &quot;date&quot;
  placeDf &lt;- f[,which(f[1,] == i)]
  itemWithNull &lt;- unique(as.vector(as.matrix(f[2,])[1,]))
  placeDfList &lt;- list()
  for(j in itemWithNull){
    thisItemDf &lt;- placeDf[,which(placeDf[2,] == j)]
    colnames(thisItemDf) &lt;- apply(thisItemDf, 2, makeColumnName)
    thisItemDf &lt;- thisItemDf[c(-1:-3),]
    placeDfList[[removeCharFromTitle1(j)]] &lt;- cbind(yearMonthDf,thisItemDf)
  }
  dfList[[i]] &lt;- placeDfList
}
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  1 variable:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;-1.3&quot; &quot;0.2&quot; &quot;4.3&quot; &quot;9.0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;1.0&quot; &quot;3.1&quot; &quot;8.4&quot; &quot;13.1&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;-4.4&quot; &quot;-3.4&quot; &quot;0.0&quot; &quot;4.5&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  5 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;101.0&quot; &quot;138.0&quot; &quot;97.0&quot; &quot;154.0&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;17.5&quot; &quot;18.5&quot; &quot;18.0&quot; &quot;42.5&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;68.9&quot; &quot;76.0&quot; &quot;160.7&quot; &quot;165.7&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  5 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] &quot;31&quot; &quot;52&quot; &quot;8&quot; &quot;0&quot; ...
##   .. ..$ exst: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty: chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ 飛島:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  1 variable:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  4 variables:
##   .. ..$ date: Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ data: chr [1:503] NA NA NA NA ...
##   .. ..$ qlty: chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm: chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...</code></pre>
<p>「月」と，ついでだから「年」もつける。</p>
<pre class="r"><code>ymLabel &lt;- function(x, formatString) {
  return(format(x, formatString))
}

for(i in placeList){
  # 先頭列は日付
  yearMonthDf &lt;- f[,1]
  yearMonthDf &lt;- changeToDate(yearMonthDf[c(-1:-3)])
  colnames(yearMonthDf) &lt;- &quot;date&quot;
  yearMonthDf$year &lt;- as.factor(ymLabel(yearMonthDf$date, &quot;%Y&quot;))
  yearMonthDf$month &lt;- as.factor(ymLabel(yearMonthDf$date, &quot;%m&quot;))
  placeDf &lt;- f[,which(f[1,] == i)]
  itemWithNull &lt;- unique(as.vector(as.matrix(f[2,])[1,]))
  placeDfList &lt;- list()
  for(j in itemWithNull){
    thisItemDf &lt;- placeDf[,which(placeDf[2,] == j)]
    colnames(thisItemDf) &lt;- apply(thisItemDf, 2, makeColumnName)
    thisItemDf &lt;- thisItemDf[c(-1:-3),]
    placeDfList[[removeCharFromTitle1(j)]] &lt;- cbind(yearMonthDf,thisItemDf)
  }
  dfList[[i]] &lt;- placeDfList
}
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  3 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] &quot;-1.3&quot; &quot;0.2&quot; &quot;4.3&quot; &quot;9.0&quot; ...
##   .. ..$ qlty : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] &quot;1.0&quot; &quot;3.1&quot; &quot;8.4&quot; &quot;13.1&quot; ...
##   .. ..$ qlty : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] &quot;-4.4&quot; &quot;-3.4&quot; &quot;0.0&quot; &quot;4.5&quot; ...
##   .. ..$ qlty : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] &quot;101.0&quot; &quot;138.0&quot; &quot;97.0&quot; &quot;154.0&quot; ...
##   .. ..$ exst : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] &quot;17.5&quot; &quot;18.5&quot; &quot;18.0&quot; &quot;42.5&quot; ...
##   .. ..$ exst : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] &quot;68.9&quot; &quot;76.0&quot; &quot;160.7&quot; &quot;165.7&quot; ...
##   .. ..$ exst : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] &quot;31&quot; &quot;52&quot; &quot;8&quot; &quot;0&quot; ...
##   .. ..$ exst : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ qlty : chr [1:503] &quot;8&quot; &quot;8&quot; &quot;8&quot; &quot;8&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ 飛島:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  3 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] NA NA NA NA ...
##   .. ..$ qlty : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] NA NA NA NA ...
##   .. ..$ qlty : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] NA NA NA NA ...
##   .. ..$ qlty : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] NA NA NA NA ...
##   .. ..$ qlty : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] NA NA NA NA ...
##   .. ..$ qlty : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] NA NA NA NA ...
##   .. ..$ qlty : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : chr [1:503] NA NA NA NA ...
##   .. ..$ qlty : chr [1:503] &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##   .. ..$ unfm : chr [1:503] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...</code></pre>
<p>“data”はnumeric，“qlty”,“unfm”,“exst”はfactor。</p>
<pre class="r"><code>typeChange &lt;- function(x){
# data はnumeric
  replaceColumnToNumeric &lt;- c(&quot;data&quot;)
# 以下は factor
  replaceColumnToFactor &lt;- c(&quot;qlty&quot;, &quot;unfm&quot;, &quot;exst&quot;)
  columnNames &lt;- names(x)
# 列名の中で，これに含まれる列はこれこれにする
  for (i in replaceColumnToNumeric) {
    if (any(columnNames == i)) {
      x[,i] &lt;- as.numeric(x[,i])
    }
  }
  for (i in replaceColumnToFactor) {
    if (any(columnNames == i)) {
      x[,i] &lt;- as.factor(x[,i])
    }
  }
  return(x)
}
hierarchyFunc &lt;- function(x){
  y &lt;- lapply(x,typeChange)
  return(y)
}

dfList &lt;- lapply(dfList, hierarchyFunc)
str(dfList)</code></pre>
<pre><code>## List of 2
##  $ 酒田:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  3 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] -1.3 0.2 4.3 9 13.6 19.3 23.2 23.1 20.2 14.4 ...
##   .. ..$ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] 1 3.1 8.4 13.1 17.5 23.3 27 26.7 25.1 20 ...
##   .. ..$ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] -4.4 -3.4 0 4.5 9.7 15.6 19.4 19.7 14.9 8.4 ...
##   .. ..$ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] 101 138 97 154 142 ...
##   .. ..$ exst : Factor w/ 1 level &quot;0&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] 17.5 18.5 18 42.5 42 31 39.5 145 54.5 13.5 ...
##   .. ..$ exst : Factor w/ 1 level &quot;0&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] 68.9 76 160.7 165.7 205 ...
##   .. ..$ exst : Factor w/ 1 level &quot;0&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ unfm : Factor w/ 2 levels &quot;1&quot;,&quot;2&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  7 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] 31 52 8 0 0 0 0 0 0 0 ...
##   .. ..$ exst : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 1 1 1 2 2 2 2 2 2 ...
##   .. ..$ qlty : Factor w/ 3 levels &quot;1&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ 飛島:List of 8
##   ..$ 年月      :&#39;data.frame&#39;: 503 obs. of  3 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ 平均気温  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ qlty : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;4&quot;,&quot;5&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日最高気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ qlty : Factor w/ 4 levels &quot;0&quot;,&quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ unfm : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日最低気温:&#39;data.frame&#39;:    503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ qlty : Factor w/ 4 levels &quot;0&quot;,&quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ unfm : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 降水量    :&#39;data.frame&#39;:  503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ qlty : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;4&quot;,&quot;5&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日降水量  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ qlty : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;4&quot;,&quot;5&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 日照時間  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ qlty : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;4&quot;,&quot;5&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ unfm : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ 最深積雪  :&#39;data.frame&#39;:   503 obs. of  6 variables:
##   .. ..$ date : Date[1:503], format: &quot;1977-01-01&quot; ...
##   .. ..$ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ data : num [1:503] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ qlty : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>んじゃデータ集計。今年のデータでグラフ。酒田の平均気温。</p>
<pre class="r"><code>dfPlot1 &lt;- dfList[[&quot;酒田&quot;]][[&quot;平均気温&quot;]]
dfPlot2 &lt;- dfPlot1[dfPlot1$year == 2017,]
str(dfPlot1)</code></pre>
<pre><code>## &#39;data.frame&#39;:    503 obs. of  6 variables:
##  $ date : Date, format: &quot;1977-01-01&quot; &quot;1977-02-01&quot; ...
##  $ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ data : num  -1.3 0.2 4.3 9 13.6 19.3 23.2 23.1 20.2 14.4 ...
##  $ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##  $ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>str(dfPlot2)</code></pre>
<pre><code>## &#39;data.frame&#39;:    12 obs. of  6 variables:
##  $ date : Date, format: &quot;2017-01-01&quot; &quot;2017-02-01&quot; ...
##  $ year : Factor w/ 42 levels &quot;1977&quot;,&quot;1978&quot;,..: 41 41 41 41 41 41 41 41 41 41 ...
##  $ month: Factor w/ 12 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ data : num  2.3 2.8 5.2 10.5 16.3 18 24.9 25.3 20.5 15.2 ...
##  $ qlty : Factor w/ 3 levels &quot;4&quot;,&quot;5&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##  $ unfm : Factor w/ 1 level &quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>列 data がnumだと箱ひげ</p>
<pre class="r"><code>plot(dfPlot1$month, dfPlot1$data)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-11-1.png" /><!-- --></p>
<p>列 data がcharacterだと散布図</p>
<pre class="r"><code>plot(dfPlot1$month, as.character(dfPlot1$data), pch=15, col=&quot;#00ff0020&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-12-1.png" /><!-- --></p>
<pre class="r"><code>plot(dfPlot2$month, as.character(dfPlot2$data), type=&quot;o&quot;, pch=1, col=&quot;red&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-12-2.png" /><!-- --></p>
<p>散布図は plot.defaultでも。</p>
<pre class="r"><code>plot.default(dfPlot1$month, as.character(dfPlot1$data), pch=15, col=&quot;#00ff0020&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-13-1.png" /><!-- --></p>
<pre class="r"><code>plot.default(dfPlot2$month, as.character(dfPlot2$data), type=&quot;o&quot;, pch=1, col=&quot;red&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-13-2.png" /><!-- --></p>
<p>今年のデータ。</p>
<pre class="r"><code>dfPlot3 &lt;- dfPlot1[dfPlot1$year == 2018,]
dfPlot3</code></pre>
<pre><code>##           date year month data qlty unfm
## 497 2018-01-01 2018    01  1.2    8    1
## 498 2018-02-01 2018    02  0.7    8    1
## 499 2018-03-01 2018    03  6.2    8    1
## 500 2018-04-01 2018    04 11.0    8    1
## 501 2018-05-01 2018    05 15.9    8    1
## 502 2018-06-01 2018    06 20.2    8    1
## 503 2018-07-01 2018    07 26.0    8    1
## 504 2018-08-01 2018    08 25.4    8    1
## 505 2018-09-01 2018    09 21.0    8    1
## 506 2018-10-01 2018    10 16.1    8    1
## 507 2018-11-01 2018    11 13.0    4    1</code></pre>
<pre class="r"><code>plot(dfPlot3$month, as.character(dfPlot3$data), type=&quot;o&quot;, pch=1, col=&quot;red&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-14-1.png" /><!-- --></p>
<pre class="r"><code>plot(dfPlot3$month, as.character(dfPlot3$data), type=&quot;o&quot;, pch=1, col=&quot;red&quot;, xlim=c(1,12))</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-14-2.png" /><!-- --></p>
<p>重ねてみる。</p>
<pre class="r"><code>par(family = &quot;HiraKakuPro-W3&quot;, bty = &quot;l&quot;)
plot(dfPlot1$month, dfPlot1$data)
par(new=T)
plot.default(dfPlot1$month, as.character(dfPlot1$data), pch=15, col=&quot;#00ff0020&quot;)
par(new=T)
plot.default(dfPlot2$month, as.character(dfPlot2$data), type=&quot;o&quot;, pch=1, col=&quot;red&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
<p>xlim，ylim 設定して，x,y軸合わせる。</p>
<pre class="r"><code>xlimVec &lt;- c(1,12)
yMax &lt;- max(max(dfPlot1$data),max(dfPlot2$data))
yMin &lt;- min(min(dfPlot1$data),min(dfPlot2$data),0)

par(family = &quot;HiraKakuPro-W3&quot;, bty = &quot;l&quot;)
plot(dfPlot1$month, dfPlot1$data, xlim=xlimVec, ylim=c(yMin,yMax))
par(new=T)
plot.default(dfPlot1$month, as.character(dfPlot1$data), xlim=xlimVec, ylim=c(yMin,yMax), pch=15, col=&quot;#00ff0030&quot;)
par(new=T)
plot.default(dfPlot2$month, as.character(dfPlot2$data), xlim=xlimVec, ylim=c(yMin,yMax), type=&quot;o&quot;, pch=1, col=&quot;red&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-16-1.png" /><!-- --></p>
<p>重なった座標軸とラベル表示しない，点の記号変える，軸のラベルつける，凡例つける。</p>
<pre class="r"><code>xlimVec &lt;- c(1,12)
yMax &lt;- max(max(dfPlot1$data),max(dfPlot2$data))
yMin &lt;- min(min(dfPlot1$data),min(dfPlot2$data),0)

# ラベルはヒラギノ角ゴシW3，枠はL字形
par(family = &quot;HiraKakuPro-W3&quot;, bty = &quot;l&quot;)
plot(dfPlot1$month, dfPlot1$data, xlim=xlimVec, ylim=c(yMin,yMax), xlab=&quot;月&quot;, ylab=&quot;平均気温&quot;)
par(new=T)
#  axes=F, ann=F で軸とラベル消す
# 色は
# colors()
# で表示できる
plot.default(dfPlot1$month, as.character(dfPlot1$data), xlim=xlimVec, ylim=c(yMin,yMax), axes=F, ann=F, pch=15, col=&quot;#00ff0020&quot;)
par(new=T)
plot.default(dfPlot2$month, as.character(dfPlot2$data), xlim=xlimVec, ylim=c(yMin,yMax), axes=F, ann=F, type=&quot;b&quot;, pch=&quot;+&quot;, col=&quot;red&quot;, lty=3)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-17-1.png" /><!-- --></p>
<p>散布図はpointsでも。</p>
<pre class="r"><code>pchTypes &lt;- c(3,1)
lineCols &lt;- c(&quot;red&quot;, &quot;blue&quot;)
lineTypes &lt;- 3

# ラベルはヒラギノ角ゴシW3，枠はL字形
par(family = &quot;HiraKakuPro-W3&quot;, bty = &quot;l&quot;)
plot(dfPlot1$month, dfPlot1$data, xlim=xlimVec, ylim=c(yMin,yMax), xlab=&quot;月&quot;, ylab=&quot;平均気温&quot;, main=&quot;酒田 平均気温&quot;)
points(dfPlot1$month, as.character(dfPlot1$data), pch=15, col=&quot;#00ff0060&quot;)
points(dfPlot2$month, as.character(dfPlot2$data), type=&quot;b&quot;, pch=pchTypes[1], col=lineCols[1], lty=lineTypes)
points(dfPlot3$month, as.character(dfPlot3$data), type=&quot;b&quot;, pch=pchTypes[2], col=lineCols[2], lty=lineTypes)

par(xpd=T)
legend(&quot;topleft&quot;,c(&quot;2017&quot;,&quot;2018&quot;), pch=pchTypes, col=lineCols, lty=lineTypes, bty=&quot;n&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-18-1.png" /><!-- --></p>
<pre class="r"><code># legend(par()$usr[2], par()$usr[4], c(&quot;テスト1&quot;))</code></pre>
<p>boxplotのテスト</p>
<pre class="r"><code>par(family = &quot;HiraKakuPro-W3&quot;, bty = &quot;l&quot;)
boxplot(dfPlot1$data ~ dfPlot1$month, xlim=xlimVec, ylim=c(yMin,yMax), notch=T, width=rep(0.005, 12), at=(1:12)+0.2, border=&quot;#0000ff66&quot;, col=&quot;#0000ff20&quot;, xlab=&quot;月&quot;, ylab=&quot;平均気温&quot;, main=&quot;酒田 平均気温&quot;)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-19-1.png" /><!-- --></p>
<p>さて，データ集計からグラフ描画までまとめてみる。</p>
<pre class="r"><code># データ取得
dfPlot1 &lt;- dfList[[&quot;酒田&quot;]][[&quot;最深積雪&quot;]]
# dfPlot1_1 &lt;- dfPlot1[dfPlot1$year == 2018,]
# dfPlot1_2 &lt;- dfPlot1[dfPlot1$year == 2018,]

dfPlot2 &lt;- dfList[[&quot;飛島&quot;]][[&quot;最深積雪&quot;]]
# dfPlot2_2 &lt;- dfPlot1[dfPlot1$year == 2018,]

# dfPlot3 &lt;- dfList[[&quot;飛島&quot;]][[&quot;日最低気温&quot;]]
# dfPlot3_2 &lt;- dfPlot1[dfPlot1$year == 2018,]

pchTypes &lt;- c(3,1)
lineCols &lt;- c(&quot;red&quot;, &quot;blue&quot;)
lineTypes &lt;- 3
xlimVec &lt;- c(1,12)
yMax &lt;- max(max(dfPlot2$data, na.rm = T),max(dfPlot3$data, na.rm = T))</code></pre>
<pre><code>## Warning in max(dfPlot2$data, na.rm = T): max の引数に有限な値がありません:
## -Inf を返します</code></pre>
<pre class="r"><code>yMin &lt;- min(min(dfPlot2$data, na.rm = T),min(dfPlot3$data, na.rm = T),0)</code></pre>
<pre><code>## Warning in min(dfPlot2$data, na.rm = T): min の引数に有限な値がありません:
## Inf を返します</code></pre>
<pre class="r"><code># ラベルはヒラギノ角ゴシW3，枠はL字形
quartz(&quot;test %d&quot;,10,10)
par(family = &quot;HiraKakuPro-W3&quot;, bty = &quot;l&quot;)
# 箱ひげ
# plot(dfPlot1$month, dfPlot1$data, at=1:12+0.2, xlim=xlimVec, ylim=c(yMin,yMax), xlab=&quot;月&quot;, ylab=&quot;平均気温&quot;, main=&quot;酒田 平均気温&quot;)
# plot(dfPlot1$month, dfPlot1$data, xlim=xlimVec, ylim=c(yMin,yMax), xlab=&quot;月&quot;, ylab=&quot;平均気温&quot;, main=&quot;酒田 平均気温&quot;)
boxplot(dfPlot1$data ~ dfPlot1$month, xlim=xlimVec, ylim=c(yMin,yMax), notch=T, boxwex=0.4, at=(1:12)-0.2, border=&quot;#0000ff66&quot;, col=&quot;#0000ff20&quot;, xlab=&quot;月&quot;, ylab=&quot;最低気温&quot;, main=&quot;最低気温&quot;)</code></pre>
<pre><code>## Warning in bxp(list(stats = structure(c(3, 14, 27.5, 38, 58, 1, 14, 24, :
## some notches went outside hinges (&#39;box&#39;): maybe set notch=FALSE</code></pre>
<pre class="r"><code># points(dfPlot1$month, as.character(dfPlot1$data), pch=15, col=&quot;#00ff0060&quot;)
# points(dfPlot1_1$month, as.character(dfPlot1_1$data), type=&quot;b&quot;, pch=pchTypes[1], col=lineCols[1], lty=lineTypes)
# points(dfPlot1_2$month, as.character(dfPlot1_2$data), type=&quot;b&quot;, pch=pchTypes[2], col=lineCols[2], lty=lineTypes)

par(xpd=T)
# legend(&quot;topleft&quot;,c(&quot;酒田&quot;,&quot;飛島&quot;), pch=pchTypes, col=lineCols, lty=lineTypes, bty=&quot;n&quot;)
par(new=T)
# plot(dfPlot3$month, dfPlot3$data, at=1:12-0.2, xlim=xlimVec, ylim=c(yMin,yMax), border=&quot;#0000ff66&quot;, col=&quot;#0000ff30&quot;, xlab=&quot;月&quot;, ylab=&quot;平均気温&quot;, main=&quot;酒田 平均気温&quot;, axes=F, ann=F)
plot(dfPlot2$month, dfPlot2$data, xlim=xlimVec, ylim=c(yMin,yMax), notch=T, boxwex=0.4, at=(1:12)+0.2, border=&quot;#ff000066&quot;, col=&quot;#ff000020&quot;, xlab=&quot;月&quot;, ylab=&quot;平均気温&quot;, main=&quot;酒田 平均気温&quot;, axes=F, ann=F)</code></pre>
<p><img src="jma_split_item_files/figure-html/unnamed-chunk-20-1.png" /><!-- --></p>
<p>ところで，地名と項目名の一覧。</p>
<pre class="r"><code>placeList &lt;- names(dfList)
placeList</code></pre>
<pre><code>## [1] &quot;酒田&quot; &quot;飛島&quot;</code></pre>
<pre class="r"><code>names(dfList[1])</code></pre>
<pre><code>## [1] &quot;酒田&quot;</code></pre>
<pre class="r"><code>names(dfList[[1]])</code></pre>
<pre><code>## [1] &quot;年月&quot;       &quot;平均気温&quot;   &quot;日最高気温&quot; &quot;日最低気温&quot; &quot;降水量&quot;    
## [6] &quot;日降水量&quot;   &quot;日照時間&quot;   &quot;最深積雪&quot;</code></pre>
<pre class="r"><code>nameList &lt;- list()
getItemList &lt;- function(lst){
  return(lapply(lst,function(x){return(names(x))}))
}
# itemList &lt;- lapply(dfList, getItemList)
getItemList(dfList)</code></pre>
<pre><code>## $酒田
## [1] &quot;年月&quot;       &quot;平均気温&quot;   &quot;日最高気温&quot; &quot;日最低気温&quot; &quot;降水量&quot;    
## [6] &quot;日降水量&quot;   &quot;日照時間&quot;   &quot;最深積雪&quot;  
## 
## $飛島
## [1] &quot;年月&quot;       &quot;平均気温&quot;   &quot;日最高気温&quot; &quot;日最低気温&quot; &quot;降水量&quot;    
## [6] &quot;日降水量&quot;   &quot;日照時間&quot;   &quot;最深積雪&quot;</code></pre>
<p>さて，地名と項目名から箱ひげ図や散布図。</p>
<pre class="r"><code>dataByPlaceItem &lt;- function(df,place,item){
  return(df[[place]][[item]])
}

getCombinedData &lt;- function(df, place, item) {
  if (length(place) == 2 &amp;&amp; length(item) == 1) {
    resultDf1 &lt;- as.data.frame(dfList[[place[1]]][[item]])
    resultDf2 &lt;- as.data.frame(dfList[[place[2]]][[item]])
    resultDf &lt;- list(resultDf1,resultDf2)
    titleCommon &lt;- item
    names(resultDf) &lt;- place
  } else if (length(place) == 1 &amp;&amp; length(item) == 2) {
    resultDf1 &lt;- as.data.frame(dfList[[place]][[item[1]]])
    resultDf2 &lt;- as.data.frame(dfList[[place]][[item[2]]])
    resultDf &lt;- list(resultDf1,resultDf2)
    titleCommon &lt;- place
    names(resultDf) &lt;- item
  } else {
    return(&quot;place and item are both vector or both not&quot;)
    break
  }
  return(list(&quot;result&quot;=resultDf, &quot;commonCond&quot;=titleCommon))
}
# str(getCombinedData(dfList, &quot;酒田&quot;, c(&quot;日最低気温&quot;,&quot;日最高気温&quot;)))
# dfPlot1_1 &lt;- dfPlot1[dfPlot1$year == 2018,]
plotResult &lt;- getCombinedData(dfList, c(&quot;酒田&quot;,&quot;飛島&quot;), &quot;日最低気温&quot;)
# plotResult
place1 &lt;- plotResult$result
names(place1[1])</code></pre>
<pre><code>## [1] &quot;酒田&quot;</code></pre>
<pre class="r"><code>plotResult$commonCond</code></pre>
<pre><code>## [1] &quot;日最低気温&quot;</code></pre>
<pre class="r"><code># place1_name &lt;- names(plotResult[[result]][1])
# place1_name


pchTypes &lt;- c(3,1)
lineCols &lt;- c(&quot;red&quot;, &quot;blue&quot;)
lineTypes &lt;- 3

# ラベルはヒラギノ角ゴシW3，枠はL字形
par(family = &quot;HiraKakuPro-W3&quot;, bty = &quot;l&quot;)</code></pre>
<ul>
<li>地名・項目名の箱ひげ・散布図</li>
<li>地名・項目名・年の（折れ線）グラフ</li>
</ul>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
